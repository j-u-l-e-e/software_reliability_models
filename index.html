<!DOCTYPE html>
<html lang="lv">
<head>
    <title>Rīki programmatūras drošuma novērtēšanai</title>
    <meta charset="UTF-8">
    <link rel="stylesheet" type="text/css" href="css/style.css"/>
    <script src="js/weibullmodel.js"></script>
    <script src="js/textmodel.js"></script>
    <script src="js/util.js"></script>
    <script src="js/papaparse.min.js"></script>
    <script type="text/javascript" src="js/math.js"></script>
    <script type="text/javascript" src="js/latexit.js"></script>

</head>

<script>
    var delimeter = ",";
    var tolerance = 0.0001;
    var decimals = 4;
</script>
<body>

<h1>Rīki programmatūras drošuma novērtēšanai</h1>

<div>
    <label for="inputSoftwareTitle">Programmatūras nosaukums</label>
    <input id="inputSoftwareTitle" type="text">
    <button id="buttonSaveResults">Saglabāt rezultātu</button>

    <script>
        // Object with current results for current software tested
        var results = {
            title: null,
            MusaOkumoto: null,
            EndTime: null,
            Lipov: null,
            Schneidewind: null,
            Weibull: null,
            Text: null
        };

        document.getElementById('inputSoftwareTitle').addEventListener("change", function (ev) {
            results.title = document.getElementById('inputSoftwareTitle').value;
            document.getElementById("headingResults").innerHTML = "Rezultātu kopsavilkums programmatūrai: " + results.title;
        });

        document.getElementById("buttonSaveResults").addEventListener("click", function (ev) {
            var blob = new Blob([JSON.stringify(results)], {type: 'text/plain;charset=utf-8'});
            anchor = document.createElement('a');
            anchor.download = results.title + '.json';
            anchor.href = window.URL.createObjectURL(blob);
            anchor.dataset.downloadurl = ['text/plain', anchor.download, anchor.href].join(':');
            anchor.click();
        })
    </script>
</div>
<br>

<div class="tab">
    <button class="tablinks" onclick="openTab(event, 'MusaOkumoto')" id="defaultTab">Musa-Okumoto modelis</button>
    <button class="tablinks" onclick="openTab(event, 'EndTime')">Modelis programmas pabeigšanas laika noteikšanai
    </button>
    <button class="tablinks" onclick="openTab(event, 'Lipov')">Lipova modelis</button>
    <button class="tablinks" onclick="openTab(event, 'Schneidewind')">Šneidevinda modelis</button>
    <button class="tablinks" onclick="openTab(event, 'Weibull')">Veibula modelis</button>
    <button class="tablinks" onclick="openTab(event, 'Text')">Teksta modelis</button>
    <button class="tablinks" onclick="openTab(event, 'divResults')" id="buttonResults">Rezultātu kopsavilkums</button>

</div>

<div id="MusaOkumoto" class="tabcontent">
    <script type="text/javascript">
        var predictionTime;
        var failureTimes;
        var beta0, beta1;
        var initialFailureRate;
        var failureRateDecay;
        var failureRate;

        function MusaOkumoto() {
            predictionTime = parseFloat(document.getElementById("inputPredictionTimeMO").value);

            if (isNaN(predictionTime) || predictionTime < 0) {
                alert("Prognozāšanas laiks var būt tikai vesels pozitīvs skaitlis");
                return;
            }

            try {
                failureTimes = parseArray(document.getElementById("inputFailureTimeMO").value, delimeter);
            } catch (e) {
                alert(e.message);
                return;
            }

            if (!failureTimes) {
                alert("Atteiču laiki var būt tikai veseli skaitļi lielāki par 0");
            }

            for (var i = 0; i < failureTimes.length; i++) {
                var time = parseFloat(failureTimes[i]);
                if (time > 0) {
                    failureTimes[i] = time;
                } else {
                    alert("Atteiču laiki var būt tikai veseli skaitļi lielāki par 0");
                    return;
                }
            }

            calcParametersMO();

            failureRateDecay = 1 / beta0;
            initialFailureRate = beta1 / failureRateDecay;

            failureRate = beta0 * beta1 / (beta1 * predictionTime + 1);

            document.getElementById("failureRateDecayMO").innerHTML = failureRateDecay.toFixed(decimals);
            document.getElementById("initialFailureRateMO").innerHTML = initialFailureRate.toFixed(decimals);
            document.getElementById("failureRateMO").innerHTML = failureRate.toFixed(decimals);
            updateMusaOkumotoResult();
        }

        function updateMusaOkumotoResult() {
            results.MusaOkumoto = {
                failureRate: failureRate,
                failureRateDecay: failureRateDecay,
                initialFailureRate: initialFailureRate,
                predictionTime: predictionTime
            }
        }

        function calcParametersMO() {
            function calcBeta1() {
                var step = tolerance;
                beta1 = step;
                var n = failureTimes.length - 1;

                var diffPrev = NaN;

                while (true) {
                    var tmp = 1 + beta1 * failureTimes[n];

                    var s1 = 0;
                    for (var i = 0; i <= n; i++) {
                        s1 += 1 / (1 + beta1 * failureTimes[i]);
                    }
                    s1 *= (1 / beta1);

                    var s2 = (n * failureTimes[n]) / (tmp * Math.log(tmp));

                    var diff = Math.abs(s1 - s2);

                    if (diff <= tolerance) {
                        break;
                    }

                    if (!isNaN(diffPrev)) {
                        if (diff > diffPrev) {
                            break;
                        }
                    }

                    diffPrev = diff;

                    beta1 += step;
                }

                return beta1;
            }

            function calcBeta0() {
                var n = failureTimes.length - 1;
                beta0 = n / Math.log(1 + beta1 * failureTimes[n]);
            }

            calcBeta1();
            calcBeta0();
        }
    </script>

    <h1>Musa-Okumoto modelis</h1>

    <button onclick="window.open('about/4.html', 'Musa-Okumoto modelis', 'width=300,height=500')">Par Musa-Okumoto
        modeli
    </button>
    <button onclick="window.open('guide/4.html', 'Instrukcijas Musa-Okumoto modeļa lietošanai', 'width=300,height=500')">
        Instrukcijas
    </button>
    <br>
    <br>

    <table>
        <tr>
            <td><label for="inputPredictionTimeMO">Laiks prognozēšanai, <i>t</i></label></td>
            <td><input type="number" id="inputPredictionTimeMO" step="1"></td>
        </tr>

        <tr>
            <td><label for="inputFailureTimeMO">Atteiču laiki, <i>f<sub>i</sub></i></label></td>
            <td><textarea id="inputFailureTimeMO"></textarea></td>
        </tr>
    </table>

    <button onclick="MusaOkumoto()">Aprēķināt</button>
    <br>
    <br>
    Atteiču intensitātes samazināšanas parametrs, <i>θ</i> = <span id="failureRateDecayMO"></span><br><br>
    Sākotnēja atteiču intensitāte, <i>λ<sub>0</sub></i> = <span id="initialFailureRateMO"></span><br><br>
    Atteiču intensitāte, <i>λ(t)</i> = <span id="failureRateMO"></span><br><br>
</div>

<div id="EndTime" class="tabcontent">
    <h1>Modelis programmas pabeigšanas laika noteikšanai</h1>
    <button onclick="window.open('about/21.html', 'Modelis programmas pabeigšanas laika noteikšanai', 'width=300,height=500')">
        Par modeli programmas pabeigšanas laika noteikšanai
    </button>
    <button onclick="window.open('guide/21.html', 'Instrukcijas modeļa programmas pabeigšanas laika noteikšanai lietošanai', 'width=300,height=500')">
        Instrukcijas
    </button>
    <br>
    <br>

    <table>
        <tr>
            <td>
                <label for="textareaErrorProbability">Moduļa kļūdas labošanas varbūtības (2D matrica),
                    <i>P<sub>i,j</sub></i>:</label>
            </td>
            <td>
                <textarea id="textareaErrorProbability"></textarea>
            </td>
        </tr>
        <tr>
            <td>
                <label for="textareaErrorsCount">Kļūdu skaits moduļos (vektors), <i>A<sub>i</sub></i>:</label>
            </td>
            <td>
                <textarea id="textareaErrorsCount"></textarea>
            </td>
        </tr>
        <tr>
            <td>
                <label for="inputTimePerError">Stundu skaits priekš vienas kļūdas labošanai,
                    <i>t<sub>0</sub></i></label>
            </td>
            <td>
                <input type="number" step="0.0001" min="0" id="inputTimePerError">
            </td>
        </tr>
    </table>

    <button onclick="calc()">Aprēķināt</button>
    <br>
    <br>

    <span id="result2"></span>

    <script>
        function parseCsv(dataStr) {
            var arr = []; // 2D array
            Papa.parse(dataStr, {
                complete: function (results) {
                    if (results.errors.length === 0) { // data ok
                        // Loop by rows
                        for (var i = 0; i < results.data.length; i++) {
                            arr.push([]);
                            var row = arr[arr.length - 1];
                            // Loop by columns
                            for (var j = 0; j < results.data[i].length; j++) {
                                var variability = results.data[i][j];
                                variability.replace(' ', '');
                                variability = parseFloat(variability);
                                row.push(variability);
                            }
                        }
                    } else {
                        throw new Exception("Dati neatbilst šablonam");
                    }
                }
            });
            return arr;
        }

        function calc(event) {
            function clearMO() {
                document.getElementById("result2").innerHTML = "";
            }

            clearMO();

            var ErrorProbability = [];
            var ErrorsCount;
            try {
                ErrorProbability = parseCsv(document.getElementById("textareaErrorProbability").value);
            } catch (e) {
                alert(e.message);
                return;
            }

            try {
                ErrorsCount = parseArray(document.getElementById("textareaErrorsCount").value, delimeter);
            } catch (e) {
                alert(e.message);
                return;
            }

            if (!ErrorsCount) {
                alert("Kļūdu skaiti moduļos var būt tikai veseli pozitivi skaitļi");
                return;
            }

            for (var i = 0; i < ErrorsCount.length; i++) {
                var count = parseNaturalNumber(ErrorsCount[i], true);
                if (isNaN(count)) {
                    alert("Kļūdu skaiti moduļos var būt tikai veseli pozitivi skaitļi");
                    return;
                } else {
                    ErrorsCount[i] = count;
                }
            }

            var TimePerError = document.getElementById("inputTimePerError").value;
            var ErrorSum = [];
            var Summa = 0;
            var P = 0;
            var columns = 0;

            //Check Matrix stucture correction
            for (var i = 0; i < ErrorProbability.length; i++) {
                for (var j = 0; j < ErrorProbability.length; j++) {
                    var variability = ErrorProbability[i][j];
                    if (variability < 0) {
                        alert("Nepareizi aizpildīta matrica, varbūtība nevar būt negatīva");
                        return;
                    }
                    P = P + Number(variability);
                    columns = j + 1;
                }
            }
            if (ErrorProbability.length !== columns) {
                alert("Nepareizi aizpildīta matrica, rindiņu un colonu skaits nav vienādi");
                return;
            }

            //Check typed Errors count
            if (ErrorProbability.length !== ErrorsCount.length) {
                alert("Ievadītais kļūdas vertības skaits - " + ErrorsCount.length + " nav vienads ar matricas izmēru - " + ErrorProbability.length);
                return;
            }

            //Check that Matrix was filled correctly
            for (i = 0; i < ErrorProbability.length; i++) {
                P = 0;
                for (j = 0; j < ErrorProbability.length; j++) {
                    P = P + Number(ErrorProbability[i][j]);
                }
                if (P !== 1) {
                    alert("Nepareizi aizpildīta varbūtības matrica " + Number(i + 1) + " rindā, varbūtības summa rindā jābūt vienāda 1");
                    return;
                }
            }

            //Check that Time Per Error not null
            if (isNaN(TimePerError) || Number(TimePerError) <= 0) {
                alert("Stundu skaitam jābūt lielākam par 0!");
                return;
            }

            //Calculate error cound per Module depending from another Modules
            for (i = 0; i < ErrorProbability.length; i++) {
                for (j = 0; j < ErrorProbability.length; j++) {
                    ErrorProbability[i][j] = ErrorProbability[i][j] * ErrorsCount[i]
                }
            }

            //Calculate error sum per Module
            for (j = 0; j < ErrorProbability.length; j++) {
                for (i = 0; i < ErrorProbability.length; i++) {
                    Summa = Summa + ErrorProbability[i][j]
                }
                Summa = Summa + Number(ErrorsCount[j]);
                ErrorSum.push(Summa);
                Summa = 0;
            }

            //Calculate how much time will be necassary to fix each Module
            result2 = "";
            for (i = 0; i < ErrorSum.length; i++) {
                result2 = result2 + Number(i + 1) + ". Modulīm vajadzes " + Math.ceil(ErrorSum[i] * TimePerError) + " stundas priekš " + ErrorSum[i] + " kļūdas labošanai;" + "<br>";
            }
            document.getElementById("result2").innerHTML = result2;
            ErrorProbability.length = 0;
            updateEndTimeResult();
        }

        function goBack() {
            window.history.back();
        }

        function updateEndTimeResult() {
            results.EndTime = {debugTime: result2};
        }

    </script>
</div>

<div id="Lipov" class="tabcontent">
    <script type="text/javascript">
        function checkOne(N, n) {
            return N >= n && n >= 0;
        }

        function checkTwo(M, m) {
            return M >= m && m >= 0;
        }

        function checkThree(k, n, m) {
            return k >= 0 && k >= n + m;
        }

        function Lipova() {
            function clearResults() {
                document.getElementById("result3").innerHTML = "";
                document.getElementById("qId").innerHTML = "";
            }

            function updateLipovResult() {
                results.Lipov = {failureProbability: res.toFixed(decimals)};
            }

            clearResults();

            if (!isInt(document.getElementById("overallBroughtErrorCount").value)) {
                alert("Ienesto kļūdu skaits nevar būt daļskaitlis");
                return;
            }

            if (!isInt(document.getElementById("testsCountUsedForTesting").value)) {
                alert("Testēšanai lietoto testu skaits nevar būt daļskaitlis");
                return;
            }

            if (!isInt(document.getElementById("ownErrorCount").value)) {
                alert("Atrasto dabīgo kļūdu skaits nevar būt daļskaitlis");
                return;
            }

            if (!isInt(document.getElementById("broughtErrorCount").value)) {
                alert("Atrasto mākslīgo kļūdu skaits nevar būt daļskaitlis");
                return;
            }

            var N;
            var M = parseInt(document.getElementById("overallBroughtErrorCount").value);
            var k = parseInt(document.getElementById("testsCountUsedForTesting").value);
            var n = parseInt(document.getElementById("ownErrorCount").value);
            var m = parseInt(document.getElementById("broughtErrorCount").value);
            var q;
            var res;

            document.getElementById("result3").style.color = "black";

            if (M < 0) {
                alert("Ienesto kļūdu skaits mazāk par 0");
                return;
            }

            if (n <= 0) {
                alert("Atrasto dabīgo kļūdu skaits nevar būt vienāds vai mazāk par 0");
                return;
            }

            if (m < 0) {
                alert("Atrasto mākslīgo kļūdu skaits nevar būt mazāk par 0");
                return;
            }

            if (k < 0) {
                alert("Testēšanai lietoto testu skaits nevar būt mazāk par 0");
                return;
            }

            if (M === '' || k === '' || n === '' || m === '' || k === '') {
                alert("Ievadiet visus nepieciešamus datus");
                return;
            }

            if (n === 0) {
                N = 0;
            } else if (m === 0) {
                N = n * M;
            } else {
                N = M * n / m;
            }

            if (!checkOne(N, n)) {
                alert("Nav izpildīts nosacījums: N >= n >= 0");
                return;
            }
            if (!checkTwo(M, m)) {
                alert("Nav izpildīts nosacījums: M >= m >= 0");
                return;
            }
            if (!checkThree(k, n, m)) {
                alert("Nav izpildīts nosacījums: k >= n + m >= 0 ");
                return;
            }
            q = (n + m) / n;
            res = k / (n + m);
            res *= Math.pow(q, n + m);
            res *= Math.pow((1 - q), k - n - m);
            res *= ((N / n) * (M / m)) / ((N + M) / (n + m));
            document.getElementById("result3").innerHTML = res.toFixed(decimals);
            document.getElementById("qId").innerHTML = q.toFixed(decimals);
            document.getElementById("spanNaturalErrorsCount").innerHTML = N;

            updateLipovResult();
        }
    </script>

    <h1>Lipova modelis</h1>

    <button onclick="window.open('about/11.html', 'Lipova modeis', 'width=300,height=500')">Lipova modeis
    </button>
    <button onclick="window.open('guide/11.html', 'Instrukcijas Lipova modeļa lietošanai', 'width=300,height=500')">
        Instrukcijas
    </button>
    <br><br>

    <table>
        <tr>
            <td><label for="overallBroughtErrorCount">Ienesto kļūdu skaits, <i>M</i>:</label></td>
            <td><input id="overallBroughtErrorCount" type="number" min="0" step="1"></td>
        </tr>

        <tr>
            <td><label for="testsCountUsedForTesting">Testēšanai lietoto testu skaits, <i>k</i>:</label></td>
            <td><input id="testsCountUsedForTesting" type="number" min="0" step="1"></td>
        </tr>

        <tr>
            <td><label for="ownErrorCount">Atklāto dabīgo kļūdu skaits, <i>n</i>:</label></td>
            <td><input id="ownErrorCount" type="number" min="0" step="1"></td>
        </tr>

        <tr>
            <td><label for="broughtErrorCount">Atklāto ienesto kļūdu skaits, <i>m</i>:</label></td>
            <td><input id="broughtErrorCount" type="number" min="0" step="1"></td>
        </tr>

    </table>
    <br/>
    <button onclick="Lipova()">Aprēķināt</button>
    <br/>
    <br/>
    Dabīgo kļūdu skaits programmā, <i>N</i> = <span id="spanNaturalErrorsCount"></span><br/><br/>
    Kļūdas atrašanas varbūtība katrā no k testiem, <i>q</i> = <span id="qId"></span><br/><br/>
    Dabīgu n un mākslīgu m kļūdu atrašanas varbūtība, Q(n, m) = <span id="result3"></span><br/><br/>
</div>

<div id="Schneidewind" class="tabcontent">
    <script type="text/javascript">
        var failureRate;
        var intervalNumber;
        var intervalLength;
        var failureCounts;
        var alpha;
        var beta;
        var fn;
        var mi;
        var m;
        var predictionTime;

        function Sneid() {
            function clearResults() {
                document.getElementById("totNumFail").innerHTML = "";
                document.getElementById("betaTXT").innerHTML = "";
                document.getElementById("alphaTXT").innerHTML = "";
                document.getElementById("lambdaTXT").innerHTML = "";
            }

            document.getElementById("totNumFail").style.color = "black";

            try {
                failureCounts = parseArray(document.getElementById("fi").value, delimeter);
            } catch (e) {
                alert(e.message);
                return;
            }

            if (!failureCounts) {
                alert("Atteiču skaiti laika intervālos var būt tikai pozitīvi veseli skaitļi");
            }

            for (var i = 0; i < failureCounts.length; i++) {
                var count = parseNaturalNumber(failureCounts[i], true);
                if (isNaN(count)) {
                    alert("Atteiču skaiti laika intervālos var būt tikai pozitīvi veseli skaitļi");
                } else {
                    failureCounts[i] = count;
                }
            }

            intervalNumber = parseNaturalNumber(document.getElementById("inputInterval").value, true);
            intervalLength = parseFloat(document.getElementById("inputIntervalLength").value);

            if (isNaN(intervalNumber)) {
                clearResults();
                alert("Nav norādīts intervāla numurs prognozēšanai");
                return;
            }

            if (intervalLength <= 0) {
                clearResults();
                alert("Intervāla garums var būt tikai pozitīvs skaitlis lielāks par 0");
                return;
            }

            if (failureCounts.length < 2) {
                clearResults();
                alert("Jābūt vismaz 2 atteiču laikiem");
                return;
            }

            fn = 0;
            for (var i = 0; i < failureCounts.length; i++) {
                fn += failureCounts[i];
            }

            calParametersSchneidewind();
            predictionTime = intervalNumber * intervalLength;
            failureRate = alpha * Math.exp(-beta * predictionTime);
            mi = alpha / beta * (1 - Math.exp(-beta * intervalNumber));
            m = alpha / beta * (Math.exp(-beta * (intervalNumber - 1)) - Math.exp(-beta * intervalNumber));

            document.getElementById("betaTXT").innerHTML = beta.toFixed(decimals);

            document.getElementById("alphaTXT").innerHTML = alpha.toFixed(decimals);
            totFail = alpha / beta;
            document.getElementById("totNumFail").innerHTML = Math.round(totFail);
            document.getElementById("lambdaTXT").innerHTML = failureRate.toFixed(decimals);
            document.getElementById("miTXT").innerHTML = Math.round(mi);
            document.getElementById("mTXT").innerHTML = Math.round(m);
            document.getElementById("subInteval").innerHTML = intervalNumber;

            var spansTime = document.getElementsByClassName("spanTime");
            for (var i = 0; i < spansTime.length; i++) {
                spansTime[i].innerHTML = predictionTime;
            }

            updateSchneidewindResult();
        }

        function updateSchneidewindResult() {
            results.Schneidewind = {
                failuresCount: Math.round(totFail),
                intervalNumber: intervalNumber,
                intervalLength: intervalLength,
                predictionTime: predictionTime,
                failureRate: failureRate,
                mi: mi,
                m: m
            }
        }

        function calParametersSchneidewind() {
            var n = failureCounts.length - 1;

            function calcBeta() {
                var step = tolerance;
                beta = step;

                var s3 = 0;
                for (var i = 0; i < n; i++) {
                    s3 += i * (failureCounts[i + 1] / fn);
                }

                var diffPrev = NaN;

                while (true) {

                    var s1 = 1 / (Math.exp(beta) - 1);
                    var s2 = n / (Math.exp(beta * n) - 1);

                    var diff = Math.abs((s1 - s2) - s3);

                    if (diff <= tolerance) {
                        break;
                    }

                    if (!isNaN(diffPrev)) {
                        if (diff > diffPrev) {
                            break;
                        }
                    }

                    diffPrev = diff;

                    beta += step;
                }
            }

            function calcAlpha() {
                alpha = (beta * fn) / (1 - Math.exp(-beta * n));
            }

            calcBeta();
            calcAlpha();
        }
    </script>

    <h1>Šneidevinda modelis</h1>

    <button onclick="window.open('about/12.html', 'Šneidevinda modelis', 'width=300,height=500')">Par Šneidevinda
        modeli
    </button>

    <button onclick="window.open('guide/12.html', 'Instrukcijas Šneidevinda modeļa lietošanai', 'width=300,height=500')">
        Instrukcijas
    </button>
    <br>
    <br>

    <table>
        <tr>
            <td><label for="inputInterval">Intervāla numurs prognozēšanai, <i>i</i></label></td>
            <td><input type="number" id="inputInterval"></td>
        </tr>

        <tr>
            <td><label for="inputInterval">Intervāla garums, <i>l</i></label></td>
            <td><input type="number" id="inputIntervalLength" step="0.0001" min="0.0001"></td>
        </tr>

        <tr>
            <td><label for="fi">Atteiču skaits intervālos, <i>f<sub>i</sub></i></label></td>
            <td><textarea id="fi"></textarea></td>
        </tr>
    </table>

    <button onclick="Sneid()">Aprēķināt</button>
    <br>
    <br>
    β = <span id="betaTXT"></span><br><br>
    α = <span id="alphaTXT"></span><br><br>
    Kopējais atteiču skaits, <i>M</i> = <span id="totNumFail"></span><br><br>
    Atteiču intensitāte, <i>λ(<span class="spanTime"></span>)</i> = <span id="lambdaTXT"></span><br><br>
    Kumulatīvais vidējais atteiču skaits, <i>μ(<span class="spanTime"></span>)</i> = <span id="miTXT"></span><br><br>
    Atteiču skaits, <i>m<sub id="subInteval"></sub></i> = <span id="mTXT"></span><br><br>
</div>

<div id="Weibull" class="tabcontent">
    <h1>Veibula modelis</h1>
    <button onclick="var myWindow = window.open('about/8.html', 'Veibula modelis', 'width=300,height=500')">Par Veibula
        modeli
    </button>
    <button onclick="window.open('guide/8.html', 'Instrukcijas Veibula modeļa lietošanai', 'width=300,height=500');">
        Instrukcijas
    </button>
    <br><br>

    <table>
        <tr>
            <td>
                <label for="inputTimeCurr">Laiks prognozēšanai, <i>t</i></label>
            </td>
            <td>
                <input id="inputTimeCurr" type="number" step="0.0001">
            </td>
        <tr>
            <td><label for="textareaFailureTimes">Atteičū laiki, <i>t<sub>i</sub></i></label></td>
            <td><textarea id="textareaFailureTimes"></textarea>
                <button style="display:block;" onclick="document.getElementById('inputFailuresDataFile').click()">
                    Importēt no
                    .csv
                </button>
                <input type='file' id="inputFailuresDataFile" style="display:none" accept=".csv">
            </td>
        </tr>

        <tr>
            <td colspan="2">
                <label for="inputManualParameters">Patstāvīgi izvēlēties parametru vērtības</label>
                <input type="checkbox" id="inputManualParameters">
            </td>
        </tr>

        <tr>
            <td><label for="inputScale">α</label>
                <input id="inputScale" type="number" min="0.001" step="0.001" disabled="disabled"
                       onblur="this.value = Math.abs(this.value)">
            </td>
            <td><label for="inputShape">β</label>
                <input id="inputShape" type="number" min="0.001" step="0.001" disabled="disabled"
                       onblur="this.value = Math.abs(this.value)">
            </td>
        </tr>
    </table>

    <div>
        <button onclick="calcWeibull()">Aprēķināt</button>
    </div>

    <br><br>
    Drošums, <i>R(t)</i> = <span id="pReliability"></span><br><br>
    Atteiču intensitāte, <i>λ(t)</i> = <span id="pFailureRate"></span><br><br>
    Vidējais laiks starp atteicēm, <i>MTTF</i> = <span id="pMTTF"></span><br><br>

    <script>
        var weibullModel = WeibullModel();
        var inputFailuresDataFile = document.getElementById("inputFailuresDataFile");
        var inputManualParameters = document.getElementById("inputManualParameters");
        var manualParameters = false;

        inputManualParameters.addEventListener("change", function () {
            manualParameters = !manualParameters;
            var inputScale = document.getElementById("inputScale");
            var inputShape = document.getElementById("inputShape");
            inputScale.disabled = !inputScale.disabled;
            inputShape.disabled = !inputShape.disabled;
        });

        function calcWeibull(event) {
            document.getElementById("pReliability").innerHTML = "";
            document.getElementById("pFailureRate").innerHTML = "";
            document.getElementById("pMTTF").innerHTML = "";

            // Parse model data
            var timeCurr = parseInt(document.getElementById("inputTimeCurr").value);
            var failureTimes;

            try {
                failureTimes = parseArray(document.getElementById("textareaFailureTimes").value, delimeter);
            } catch (e) {
                alert(e.message);
                return;
            }

            var scale = false;
            var shape = false;

            if (manualParameters) {
                scale = parseFloat(document.getElementById("inputScale").value);
                shape = parseFloat(document.getElementById("inputShape").value);
            }

            try {
                weibullModel.setup(failureTimes, timeCurr, scale, shape);
            } catch (e) {
                alert(e.message);
                return false;
            }

            // Data OK, show calculated data
            document.getElementById("pReliability").innerHTML = weibullModel.getReliability().toFixed(decimals);
            document.getElementById("pFailureRate").innerHTML = weibullModel.getFailureRate().toFixed(decimals);
            document.getElementById("pMTTF").innerHTML = weibullModel.getMTTF().toFixed(decimals);

            if (!manualParameters) {
                document.getElementById("inputScale").value = weibullModel.getScale().toFixed(decimals);
                document.getElementById("inputShape").value = weibullModel.getShape().toFixed(decimals);
            }
            updateWeibullResult();
            return true;
        }

        function updateWeibullResult() {
            results.Weibull = {
                reliability: weibullModel.getReliability(),
                failureRate: weibullModel.getFailureRate(),
                predictionTime: weibullModel.getTimeCurr(),
                MTTF: weibullModel.getMTTF()
            }
        }

        inputFailuresDataFile.addEventListener("change", function (evt) {
            var failuresDataFile = evt.target.files[0];

            Papa.parse(failuresDataFile, {
                delimiter: delimeter, // to avoid error "Unable to auto-detect delimiting character" when one column
                complete: function (results) {
                    if (results.errors.length === 0) { // data ok
                        var failureTimes = "";

                        for (var i = 0; i < results.data.length; i++) {
                            if (results.data[i].length !== 1) {
                                alert(".csv datnes struktūra neatbilst šablonām: [Atteices laiks]");
                                document.getElementById("textareaFailureTimes").value = "";
                                return false;
                            }
                            if (results.data[i][0]) failureTimes += results.data[i][0] + delimeter;
                            else failureTimes += 0 + delimeter;
                        }
                        // Remove \n in the end of strings
                        failureTimes = failureTimes.slice(0, failureTimes.length - 1);

                        document.getElementById("textareaFailureTimes").value = failureTimes;
                    }
                }
            });
        });

    </script>
</div>

<div id="Text" class="tabcontent">
    <h1>Teksta modelis</h1>
    <button onclick="window.open('about/19.html', 'Teksta modelis', 'width=300,height=500')">Par Teksta modeli</button>
    <button onclick="window.open('guide/19.html', 'Instrukcijas Teksta modeļa lietošanai', 'width=300,height=500')">
        Instrukcijas
    </button>
    <br><br>

    <div>
        <table>
            <tr>
                <td>
                    <label for="inputOperandsTotalCount">Programatūras garums, <i>N</i>:</label>
                </td>
                <td>
                    <input id="inputOperandsTotalCount" type="number" min="0" step="1"
                           onblur="this.value = parseInt(this.value)">
                </td>
            </tr>

            <tr>
                <td>
                    <label for="inputUnitsCount">Kopējais moduļu skaits, <i>n</i>:</label>
                </td>
                <td>
                    <input id="inputUnitsCount" type="number" min="0" step="1"
                           onblur="this.value = parseInt(this.value)">
                </td>
            </tr>

            <tr>
                <td>[Koda garums, N<i>i</i>],[Kļūdu skaits, B<i>i</i>]</td>
                <td>[Testēšanas pakāpe]</td>
            </tr>
            <tr>
                <td>
                    <textarea id="textareaData" onmousemove="resize();"></textarea>
                </td>
                <td>
                    <textarea id="textareaTestCoverage" disabled="disabled"></textarea>
                </td>
            </tr>
            <tr>
                <td colspan="2">
                    <button style="display:block;" onclick="document.getElementById('inputUnitsDataFile').click()">
                        Importēt no
                        .csv
                    </button>
                    <input type='file' id="inputUnitsDataFile" style="display:none" accept=".csv">
                </td>
            </tr>
        </table>
    </div>
    <div>
        <label id="labelInputAvgErrorsCount" for="inputAvgErrorsCount" style="display:none">Vidējais kļūdu skaits
            moduļos, <i>B<sub>vid</sub></i>:</label>
        <input id="inputAvgErrorsCount" type="number" min="0" step="1" onblur="this.value = parseInt(this.value)"
               style="display:none">
    </div>
    <div>
        <button onclick="calcText()">Aprēķināt</button>
    </div>
    <br><br>

    Vidējais moduļu garums, <i>N<sub>vid</sub></i> = <span id="pAvgCodeLength"></span><br><br>
    Sakumkļūdu skaits programmatūrā, <i>B</i> = <span id="pInitialErrorsCount"></span><br><br>

    <!-- Put script after all DOM elements are initialized -->
    <script>
        var inputCodeLengthTotal = document.getElementById("inputOperandsTotalCount");
        var inputUnitsCount = document.getElementById("inputUnitsCount");
        var inputAvgErrorsCount = document.getElementById("inputAvgErrorsCount");
        var labelInputAvgErrorsCount = document.getElementById("labelInputAvgErrorsCount");
        var textareaData = document.getElementById("textareaData");
        var textareaTestCoverage = document.getElementById("textareaTestCoverage");
        var pAvgCodeLength = document.getElementById("pAvgCodeLength");
        var pInitialErrorsCount = document.getElementById("pInitialErrorsCount");
        var inputUnitsDataFile = document.getElementById("inputUnitsDataFile");

        function resize() {
            textareaTestCoverage.style.height = textareaData.style.height;
        }

        function clearT() {
            pAvgCodeLength.innerHTML = "";
            pInitialErrorsCount.innerHTML = "";
            textareaTestCoverage.value = "";
        }

        var textModel = TextModel;

        function calcText(event) {
            try {
                textModel.calc();
                // Data OK, show calculated data
                pAvgCodeLength.innerHTML = textModel.getAvgCodeLength();
                pInitialErrorsCount.innerHTML = textModel.getInitialErrorsCount();
                textareaTestCoverage.value = textModel.getTestCoverageString();
            } catch (e) {
                alert(e.message);
                clearT();
                return false;
            }

            updateTextResult();
            return true;
        }

        function updateTextResult() {
            results.Text = {
                initialErrorsCount: textModel.getInitialErrorsCount(),
                unitsData: textModel.getUnitsData()
            }
        }

        inputCodeLengthTotal.addEventListener("change", function (evt) {
            try {
                textModel.setCodeLengthTotal(parseInt(inputCodeLengthTotal.value));
            } catch (e) {
                alert(e.message);
            }
            updateAvgLengthUnitId();
        });

        inputUnitsCount.addEventListener("change", function (evt) {
            try {
                textModel.setUnitsCount(parseInt(inputUnitsCount.value));
            } catch (e) {
                alert(e.message);
            }
            updateAvgLengthUnitId();
        });

        textareaData.addEventListener("change", function (ev) {
            prepareUnitsData(textareaData.value);
        });

        function updateAvgLengthUnitId() {
            var avgLengthUnitId = textModel.getAvgLengthUnitId();
            if (avgLengthUnitId >= 0) {
                // labelInputAvgErrorsCount.innerText = "Vidējais kļūdu skaits moduļos, <i>B<sub>vid<//sub><//i> (atklāto kļūdu skaits " + avgLengthUnitId + "-tā modulī pēc \'trieciena\' metodes lietošanas):";
                labelInputAvgErrorsCount.innerHTML = "Atklāto kļūdu skaits " + avgLengthUnitId + ". modulī ar \'Trieciena\' metodi, B<sub>vid<\sub>:";
                labelInputAvgErrorsCount.style.display = "block";
                inputAvgErrorsCount.style.display = "block";
                pAvgCodeLength.innerHTML = "";
                pInitialErrorsCount.innerHTML = "";
                textareaTestCoverage.value = "";
            } else {
                labelInputAvgErrorsCount.style.display = "none";
                inputAvgErrorsCount.style.display = "none";
                pAvgCodeLength.innerHTML = "";
                pInitialErrorsCount.innerHTML = "";
                textareaTestCoverage.value = "";
            }
        }

        inputAvgErrorsCount.addEventListener("change", function (evt) {
            clearT();
            try {
                textModel.setAvgErrorsCount(parseInt(inputAvgErrorsCount.value));
            } catch (e) {
                alert(e.message);
            }
        });

        // Read units data from .csv
        inputUnitsDataFile.addEventListener("change", function (evt) {
            var unitsDataFile = evt.target.files[0];
            if (unitsDataFile) {
                var reader = new FileReader();
                reader.onload = function (event) {
                    if (prepareUnitsData(event.target.result)) {
                        textareaData.value = event.target.result;
                    } else {
                        textareaData.value = "";
                    }
                };
                reader.readAsText(unitsDataFile);
            }
        });

        function prepareUnitsData(strData) {
            var unitsData = parseTextData(strData);

            if (unitsData === -1) {
                textModel.setTestedUnits(-1);
                return false;
            } else {
                textModel.setTestedUnits(unitsData);
                updateAvgLengthUnitId();
                return true;
            }
        }

        function parseTextData(dataStr) {
            var unitsData = [];

            Papa.parse(dataStr, {
                delimiter: delimeter, // to avoid error "Unable to auto-detect delimiting character" when one column
                header: false,
                complete: function (results) {
                    if (results.errors.length === 0) { // data ok

                        for (var i = 0; i < results.data.length; i++) {
                            if (results.data[i].length !== 2) {
                                alert(".csv datnes struktūra neatbilst šablonām: [koda garums, kļūdu skaits]");
                                unitsData = -1;
                                return false;
                            }
                            try {
                                var unitLength = results.data[i][0], errorsCount = results.data[i][1];
                                unitLength = unitLength.replace(' ', '');
                                errorsCount = errorsCount.replace(' ', '');
                                unitsData.push(new UnitData(unitLength, errorsCount));
                            } catch (e) {
                                alert(e.message);
                                unitsData = -1;
                                return false;
                            }
                        }
                    } else {
                        alert(".csv datnes struktūra neatbilst šablonām: [koda garums, kļūdu skaits]");
                        unitsData = -1;
                        return false;
                    }
                }
            });

            return unitsData;
        }

    </script>
</div>

<div id="divResults" class="tabcontent">
    <h1 id="headingResults"></h1>

    <div>
        <h2>Musa-Okumoto modeļa rezultāti</h2>
        <p id="pMusaOkumoto"></p>
        <h2>Modeļa programmas pabeigšanas laika noteikšanai rezultāti</h2>
        <p id="pEndTime"></p>
        <h2>Lipova rezultāti</h2>
        <p id="pLipov"></p>
        <h2>Šneidevinda modeļa rezultāti</h2>
        <p id="pSchneidewind"></p>
        <h2>Veibula modeļa rezultāti</h2>
        <p id="pWeibull"></p>
        <h2>Teksta modeļa rezultāti</h2>
        <p id="pText"></p>
    </div>
</div>

<script>
    function openTab(evt, cityName) {
        var i, tabcontent, tablinks;
        tabcontent = document.getElementsByClassName("tabcontent");
        for (i = 0; i < tabcontent.length; i++) {
            tabcontent[i].style.display = "none";
        }
        tablinks = document.getElementsByClassName("tablinks");
        for (i = 0; i < tablinks.length; i++) {
            tablinks[i].className = tablinks[i].className.replace(" active", "");
        }
        document.getElementById(cityName).style.display = "block";
        evt.currentTarget.className += " active";
    }

    document.getElementById("defaultTab").click();

    document.getElementById("buttonResults").addEventListener("click", function () {
        document.getElementById("headingResults").innerHTML = "Rezultātu kopsavilkums programmatūrai: " + results.title;


        document.getElementById("pMusaOkumoto").innerHTML = (results.MusaOkumoto != null) ?
            "Atteiču intensitātes samazināšanas parameters, θ: " + results.MusaOkumoto.failureRateDecay.toFixed(decimals) +
            "<br> Sākotnējā atteiču intensitāte <i>λ<sub>0</sub></i>: " + results.MusaOkumoto.initialFailureRate.toFixed(decimals) +
            "<br>Atteiču intensitāte, <i>λ(" + results.MusaOkumoto.predictionTime + ")</i>: " + results.MusaOkumoto.failureRate.toFixed(decimals) :
            ""
        ;

        document.getElementById("pEndTime").innerHTML = (results.EndTime != null) ?
            "Laika patēriņš moduļu atkļūdošanai: <br>" + results.EndTime.debugTime :
            "";

        document.getElementById("pLipov").innerHTML = (results.Lipov != null) ?
            "Darbīgu <i>n</i> un mākslīgu <i>m</i> kļūdu atrašanas varbūtība, <i>Q(n,m)</i>: " + results.Lipov.failureProbability :
            "";

        document.getElementById("pSchneidewind").innerHTML = (results.Schneidewind != null) ?
            "Intervāla garums, <i>l</i>: " + results.Schneidewind.intervalLength +
            "<br>Kopējais atteiču skaits, <i>F</i>: " + results.Schneidewind.failuresCount +
            "<br>Kumulatīvais vidējais atteiču skaits, <i>μ(" + results.Schneidewind.predictionTime + ")</i>: " + results.Schneidewind.mi +
            "<br>Atteiču skaits, <i>m<sub>" + results.Schneidewind.intervalNumber + "</sub></i>: " + results.Schneidewind.m +
            "<br>Atteiču intensitāte, <i>λ(" + results.Schneidewind.predictionTime + ")</i>: " + results.Schneidewind.failureRate.toFixed(decimals) :
            "";

        document.getElementById("pWeibull").innerHTML = (results.Weibull != null) ?
            "Drošums, <i>R(" + results.Weibull.predictionTime + ")</i>: " + results.Weibull.reliability.toFixed(decimals) +
            "<br> Atteiču intensitāte, <i>λ(" + results.Weibull.predictionTime + ")</i>: " + results.Weibull.failureRate.toFixed(decimals) +
            "<br> Vidējais laiks starp atteicēm, <i>MTTF</i>: " + results.Weibull.MTTF.toFixed(decimals) :
            "";

        var pText = document.getElementById("pText");
        if (results.Text != null) {
            pText.innerHTML = "Sākumkļūdu skaits, <i>B</i>: " + results.Text.initialErrorsCount + " <br>";
            pText.innerHTML += "Moduļu testēšanas pakāpe: <br>";
            if (results.Text.unitsData != null) {
                for (var i = 0; i < results.Text.unitsData.length; i++) {
                    pText.innerHTML += "" + i + ". modulis: ";
                    if (results.Text.unitsData[i].testCoverageLow) {
                        pText.innerHTML += "zema <br>";
                    } else {
                        pText.innerHTML += "augsta <br>";
                    }
                }
            }
        } else {
            pText.innerHTML = "";
        }
    })
</script>

</body>
</html>