<!DOCTYPE html>
<html lang="lv">
<head>
    <title>Veibula modelis</title>
    <meta charset="UTF-8">
    <script src="../js/weibullmodel.js"></script>
    <script src="../js/util.js"></script>
    <script src="../js/papaparse.min.js"></script>
</head>
<body>

<h1>Veibula modelis</h1>
<button id="buttonAboutModel">Par Veibula modeli</button>
<button id="buttonHelp">Palīdzība</button>

<div>
    <label for="inputTimeCurr">Laiks prognozēšanai, t</label>
    <input id="inputTimeCurr" type="number" min="0" step="1" onblur="this.value = parseInt(this.value)">
</div>
<table>
    <tr>
        <th>Kļudu atklāšanas laiki</th>
    </tr>
    <tr>
        <td>
            <textarea id="textareaFailureTimes"></textarea>
        </td>
    </tr>
</table>
<div>
    <input id="inputFailuresDataFile" type="file" accept=".csv,.doc"/>
</div>
<div>
    <button id="buttonCalculate">Aprēķināt</button>
</div>

<p id="pReliability">
<p id="pFailureRate">
</body>
<script>
    var inputTimeCurr = document.getElementById("inputTimeCurr");
    var buttonAboutModel = document.getElementById("buttonAboutModel");
    var buttonHelp = document.getElementById("buttonHelp");
    var textareaFailureTimes = document.getElementById("textareaFailureTimes");
    var weibullModel = WeibullModel();
    var buttonCalculate = document.getElementById("buttonCalculate");
    var inputFailuresDataFile = document.getElementById("inputFailuresDataFile");
    var pReliability = document.getElementById("pReliability");
    var pFailureRate = document.getElementById("pFailureRate");


    buttonAboutModel.addEventListener("click", function () {
        var myWindow = window.open("about/8.html", "Veibula modelis", "width=300,height=500");
    });

    buttonCalculate.addEventListener("click", function (event) {

        // Parse model data
        var timeCurr = parseInt(inputTimeCurr.value);
        var failureTimes = parseNaturalNonNullNumbers(textareaFailureTimes.value);

        try {
            weibullModel.setup(failureTimes, timeCurr);

        } catch (e) {
            alert(e.message);
            return false;
        }

        // Data OK, show calculated data

        pReliability.innerHTML = "Drošums, R(t): " + weibullModel.getReliability();
        pFailureRate.innerHTML = "Atteiču intensitāte, λ(t): " + weibullModel.getFailureRate();
        return true;
    });

    inputFailuresDataFile.addEventListener("change", function (evt) {
        var failuresDataFile = evt.target.files[0];

        Papa.parse(failuresDataFile, {
            delimiter: ",", // to avoid error "Unable to auto-detect delimiting character" when one column
            complete: function (results) {
                if (results.errors.length === 0) { // data ok
                    var failureTimes = "";

                    if (results.data[0].length !== 1) {
                        alert(".csv datnes struktūra neatbilst šablonām: [kļūdu atklāšanas laiks]");
                        return false;
                    }

                    for (var i = 0; i < results.data.length; i++) {
                        if (results.data[i][0]) failureTimes += results.data[i][0] + "\n";
                        else failureTimes += 0 + "\n";
                    }
                    // Remove \n in the end of strings
                    failureTimes = failureTimes.slice(0, failureTimes.length - 1);

                    textareaFailureTimes.value = failureTimes;
                }
            }
        });
    });

</script>
</html>